<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>上级仓库</title>
        <script src="__STATIC__/js/public/rem.js" type="text/javascript" charset="utf-8"></script>
        <link rel="stylesheet" href="__STATIC__/css/public_lb/picker.css" />
		<link rel="stylesheet" href="__STATIC__/css/public_lb/public.css" />
		<link rel="stylesheet" href="__STATIC__/css/user_zp/superior_store.css?v=111" />

		<script src="__STATIC__/js/jquery-3.1.1.min.js"  type="text/javascript" ></script>
		 <script src="__STATIC__/js/layer_mobile.js"  type="text/javascript" ></script>

		
	</head>
	<body>
		<div class="wrapper">
			<!--public head-->
			
	        <div class="lb_headWrap topBox_backgroundColor">
	            <p class="lb_headWrap_return" data-num="1" onclick="returnFun()">
	                <img class="lb_headWrap_return_img" src="__STATIC__/images/public_lb/returnImg666_lb.png"/>
	            </p>
	            <span>上级仓库</span>
            </div>
            
			<!-- 主内容 -->
			<div class="content">
				<form action="{:U('Shop/Cart/cart2')}" method="post" id='kucunform' name='kucunform'>

					<input type="hidden" name="action" value="kucun_buy">
					<ul class="superior-list">
						<foreach name="kucun" id="v">
							<input type="hidden" name="goods_ids[{$v.goods_id}]" value="{$v.goods_id}">
						<li>
							<div class="check">
								<input type="checkbox" name="checkItem[{$v.goods_id}]">
							</div>
							<div class="img-wrap">
								<a href="###"><img src="{$v[goods_id]|goods_thum_images=200,200}?v={:date('Ymd')}" /></a>
							</div>
							<div class="text">
								<h3>{$v.goods_name}</h3>
								<div class="line2">
									<span>库存：{$v.nums}</span>
									<!--<span>颜色：墨绿色</span>-->
								</div>
								<div class="line3">
									<div class="price">￥{$v.shop_price}</div>
									<div class="num">
										<a href="javascript:" class="min" id="min">-</a>
										<input type="text" value="1" size="2" class="number" name='number[{$v.goods_id}]'>
										<a href="javascript:" class="add" id="add">+</a>
									</div>
								</div>
							</div>
						</li>
					</foreach>
				
					</ul>

					<div class="holderBar">
						<div class="checkAll">
							<input type="checkbox" id="checkAll">
							<label for="checkAll">全选</label>
						</div>
						<div class="total-wrap">
							<div class="line1">
								<span class="not-contain">不含运费</span>
								合计:
								<span class="total">￥0.00</span>
							</div>
							<div class="amount-sum">总件数:0</div>
						</div>
						<div class="buyBtn" onclick="form_submit();">结算</div>
				
 					</div>
				</form>	
			</div>
			
        
	       
		</div>
		
	<script src="__STATIC__/js/public/jquery-1.8.3.min.js"></script>
	<script src="__STATIC__/js/public/public_lb.js"></script>
	<script>
		$(function(){
			//加加
			$(".add").click(function(){
				var $inputVal = $(this).prev('input')
					$count = parseInt($inputVal.val())+1
					$inputVal.val($count);
					if($inputVal.val()>1 && $(".min").hasClass('reSty')){
						$(".min").removeClass('reSty');
					}
					totalMoney()
			})
			
			//减减
			$(".min").click(function(){
				var $inputVal = $(this).next('input')
					$count = parseInt($inputVal.val())-1
					if($inputVal.val()>1){
						$inputVal.val($count);
					}
					if($inputVal.val()==1 && !$(this).hasClass('reSty')){
						$(this).addClass('reSty');
					}
					totalMoney()

			})

			/**
			 * 全选的实现
			 */					
			$("#checkAll").click(function(){
				$(".check input").attr("checked",this.checked);
				totalMoney()
			});

			/**
			 * 为下面所有checkbox绑定点击事件
			 */
			 $(".check input").click(function(){
				//判断全选是否要被选中
				$("#checkAll").attr("checked",$(".check input").length == $(".check input").filter(":checked").length);
				totalMoney()
			});
			 	$(".check input").attr("checked",this.checked);
				totalMoney()

			// 总计
			function totalMoney() {
				var total_money = 0;
				var total_count = 0;

				var calBtn = $('.buyBtn');

				var $sonCheckBox = $(".check input")
				$sonCheckBox.each( (i,e)=> {
					if($(e).is(':checked')){
						total_money+=parseInt($(e).parent().parent().find('.price').html().substring(1))*parseInt($(e).parent().parent().find('.number').val())
						total_count+=parseInt($(e).parent().parent().find('.number').val())
					}
					
				});
				$('.total').html(`¥ ${total_money.toFixed(2)}`);
				$('.amount-sum').html(`总件数:${total_count}`);
				$('#amount_sum').val(total_count);
				$('#total').val(total_money);

			}

			// 判断输入的值是否为数字
			$(".number").change(function(){
				var num = this.value;
				if(!/^\d+$/.test(num)||parseInt(num) <1){
					//把input文本框中的value值进行重置
					this.value="1";
				}
				totalMoney()
			})


		})


	</script>
	<script type="text/javascript">
		function form_submit()
		{
			//获取选中的商品个数
	        var j = 0;
	        $('input[name^="checkItem"]:checked').each(function () {
	            j++;
	        });
	        //选择数大于0
	        if (j > 0) {
	            //跳转订单页面
	            document.forms['kucunform'].submit();
	           // window.location.href = "{:U('Shop/Cart/cart2')}"
	        } else {
	            layer.open({content: '请选择要结算的商品！', time:10000});
	            return false;
	        }
			
		}
	</script>
       
	</body>
</html>
